// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["interactiveTransactions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Athlete {
  id             String        @id @default(uuid()) @db.Uuid
  firstname      String        @db.VarChar(255)
  lastname       String        @db.VarChar(255)
  birthdate      DateTime
  nationality    String        @default("M") @db.VarChar(255)
  gender         String        @default("M") @db.Char(1)
  dossard        Int?
  liveId         String
  organization   Organization? @relation(fields: [organizationId], references: [id])
  organizationId String?       @db.Uuid

  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  @@index([liveId])
}

model Organization {
  id         String @id @default(uuid()) @db.Uuid
  fed_number Int
  type       String @db.VarChar(255)
  name       String @db.VarChar(255)
  abbr       String @db.VarChar(255)
  alias      String @db.VarChar(255)
  location   String @db.VarChar(255)
  federation String @db.VarChar(255)

  contact_person String?   @db.VarChar(255)
  contact_email  String?   @db.VarChar(255)
  contact_phone1 String?   @db.VarChar(255)
  contact_phone2 String?   @db.VarChar(255)
  Athlete        Athlete[]

  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt
  Event     Event[]
}

model Category {
  id             String   @id @default(uuid()) @db.Uuid
  federation     String   @db.VarChar(255)
  name           String   @db.VarChar(255)
  abbr           String   @db.VarChar(255)
  ageMin         Int
  ageMax         Int
  changeMin      String   @db.VarChar(255)
  changeMax      String   @db.VarChar(255)
  gender         String   @default("M") @db.VarChar(10)
  nationalCode   String   @db.VarChar(10)
  sortOrder      Int
  categoryId     Int
  fedinsidelabel String?  @db.VarChar(255)
  Result         Result[]
}

model Result {
  id          String   @id @default(uuid()) @db.Uuid
  eventNumber String   @db.VarChar(255)
  name        String   @db.VarChar(255)
  abbr        String   @db.VarChar(255)
  type        String   @db.VarChar(255)
  date        DateTime
  validation  String   @db.VarChar(255)
  xmlId       Int?
  round       Json?
  heat        Json?

  result          Json?
  eventCategory   Json?
  athleteCategory Json?

  eventId String @db.Uuid
  event   Event  @relation(fields: [eventId], references: [id])

  eventTypeId String?    @db.Uuid
  eventType   EventType? @relation(fields: [eventTypeId], references: [id])

  categoryId String?   @db.Uuid
  category   Category? @relation(fields: [categoryId], references: [id])
}

model Event {
  id           String    @id @default(uuid()) @db.Uuid
  eventNumber  String    @db.VarChar(255)
  name         String    @db.VarChar(255)
  date_start   DateTime
  date_end     DateTime
  start_time   DateTime?
  championship Boolean   @default(false)
  season       String?   @db.VarChar(255)
  facility     Json?

  responsible  Json?
  responsible2 Json?

  type   String? @db.VarChar(255)
  chrono String  @default("unkown") @db.VarChar(255)

  organizationId String?       @db.Uuid
  organization   Organization? @relation(fields: [organizationId], references: [id])
  Result         Result[]
}

model EventType {
  id               String  @id @default(uuid()) @db.Uuid
  venue            String  @db.Char(1)
  distance         Int
  wind_mode        String  @db.VarChar(255)
  wind_time        String  @db.VarChar(255)
  precision        Int
  handtime_diff    String  @db.VarChar(255)
  nb_athletes      Int
  implement        String  @db.VarChar(255)
  hurdles_nb       Int
  hurdles_first    Decimal @db.Decimal(p: 5, s: 2)
  hurdles_interval Decimal @db.Decimal(p: 5, s: 2)
  hurdles_last     Decimal @db.Decimal(p: 5, s: 2)
  abbr             String  @db.VarChar(255)
  name_fr          String  @db.VarChar(255)
  name_nl          String  @db.VarChar(255)
  name_de          String  @db.VarChar(255)
  name_en          String  @db.VarChar(255)
  low2high         Int
  national_code    String  @db.VarChar(255)
  sort_order       Int
  type_id          String  @db.VarChar(255)
  result_type      String  @db.VarChar(255)
  discipline_group String  @db.VarChar(255)

  Result Result[]
}
